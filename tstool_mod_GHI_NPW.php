<?phprequire_once('inc/_init.php');require_once('inc/functions/general.php');if($lghsh['Id'] == 0){	require_once('inc/functions/authorization.php'); 	$pgcontent = logform(); 	}include_once 'inc/functions.php';include_once 'wconfig.php';setlocale(LC_MONETARY, 'en_US');error_reporting(E_ALL | E_STRICT);//error_reporting(E_ERROR | E_WARNING | E_PARSE);///////////////////////////////////////////////////////////////////////////////$ln = 'ghi-'; //(isset($_GET['br']))?$_GET['br']:NULL;$postp = NULL;$dflag = true;ini_set('memory_limit', '2048M');set_time_limit ( 1500 );$brand = 'ghi';$ofs = 0;$ppp  = -1;$wsiarr = getwsline($ln, $ppp, $ofs); /// Get items array from website by brand name (Sku, Title, Regular price, Sale price) /////////////////////*$di=0;$rp4 = array('ttl' => 'Feather Lodge','slg' => 'feather-lodge','cat' => 'Feather Lodge','tag' => 'feather-lodge-newport-white');$rp2 = array('ttl' => 'GHI','slg' => 'ghi','cat' => 'GHI','tag' => 'ghi-newport-white');foreach($wsiarr as $it){	$probj = wc_get_product($it->ID);	if(preg_match('/^F/', $it->_sku) AND preg_match('/-NPW$/', $it->_sku)){//		if($it->_sku=='FW0930-NPW'){			if(1){				$prod = wc_get_product($it->ID);			$newsku = preg_replace("/^F/", 'G', $it->_sku);			$newslg = preg_replace("/feather-lodge/", 'ghi', $it->post_name);			$newttl = preg_replace('/Feather Lodge/', 'GHI', $it->post_title);			$pcat = wc_get_product_terms($it->ID, 'product_cat');			$ptag = wc_get_product_terms($it->ID, 'product_tag');			$catarr = replarray($pcat, $rp4['cat'], $rp2['cat']);			$tagarr = replarray($ptag, $rp4['tag'], $rp2['tag']);			wp_set_object_terms( $it->ID, $catarr, 'product_cat' );			wp_set_object_terms( $it->ID, $tagarr, 'product_tag' );			$probj->set_name($newttl);			$probj->set_slug($newslg);			$probj->set_sku($newsku);			//$probj->set_price(NULL);			$probj->save();			$uargs = array(				'ID' => $it->ID, 				'post_slug'     => $it->name,				'post_content'  => ' V description',				'post_excerpt' => '',				);			//wp_update_post( $uargs );			echo ++$di.'. '. $it->ID.' --- '. $it->_sku.' - - - '.$newttl.'<br>';			}		}	}exit;///////// */function replarray($parr, $nsrch, $nrplc){	$r = array();	// $key = array_search($nsrch, $parr);	// echo $parr['name'];	// if($key){ $parr[$key] = $nrplc; }	foreach($parr as $k=>$v){		if($v->name==$nsrch){ array_push($r, $nrplc); }		else { array_push($r, $v->name); }		}	return $r;}function get_wsku($wsiarr, $sku) {	foreach($wsiarr as $wi){		$skt = preg_replace('/ NEW/','',$sku);		if($skt == $wi['sku']){	return $wi;	}		}	return null;}function getvendorptbl($s){ global $dbh;	return mysqli_fetch_assoc(mysqli_query($dbh, "SELECT Sku, VPr FROM cr_vndpl WHERE SkuWC='$s'"));}function lstdpl($prod, $rp4, $rp2){$pid = $prod->id;$pcat = wc_get_product_terms($pid, 'product_cat');$ptag = wc_get_product_terms($pid, 'product_tag');$catarr = replarray($pcat, $rp4['cat'], $rp2['cat']);$tagarr = replarray($ptag, $rp4['tag'], $rp2['tag']);$ir['ttl'] = preg_replace("/$rp4[ttl]/", $rp2['ttl'], preg_replace('/ \(Copy\)/','', $prod->name)); // nameoff($pobj->name);$ir['slg'] = preg_replace('/[-]{2,7}/', '-', strtolower( preg_replace('/\s/','-', $ir['ttl']))) ; // slugoff($arr['ttl']);$ir['sku'] = preg_replace("/^$rp4[prf]/", $rp2['prf'], preg_replace('/-\d$/', '', $prod->sku)); //skuoff($pobj->sku);$ir['catarr']  = $catarr;$ir['tagarr']  = $tagarr;echo 	$ir['sku'] . ' : ' . 	$ir['ttl'] . ' : ' . 	$ir['slg'] . ' : ' .'<br>';chngrplmnt($prod, $ir);		foreach($catarr as $ct){ echo $ct.', ';} echo '<br>';	foreach($tagarr as $ft){ echo $ft.', ';} echo '<br>';			return;}function chngrplmnt($prod, $ir){$pid = $prod->id;wp_set_object_terms( $pid, $ir['catarr'], 'product_cat' );wp_set_object_terms( $pid, $ir['tagarr'], 'product_tag' );$prod->set_name($ir['ttl']);$prod->set_sku($ir['sku']);$prod->set_price(NULL);$prod->save();//chngvrplmnt($pid, $ir);$uargs = array(	'ID' => $pid, 	'post_slug'     => $ir['slg'],	'post_content'  => $ir['ttl'],	'post_status'   => 'publish',	);		wp_update_post( $uargs ); return;	}function getwsline($line, $ppp, $offs){if(!$line){return NULL;}$inc=0;	$itarr = array();$args = array(	'post_type'             => 'product',	'post_status'           => 'publish',//	'fields' => 'ids',//	'fields' => 'sku',	'ignore_sticky_posts'   => 1,	'offset' 				=> $offs,	'posts_per_page'        => $ppp,	'tax_query' => array(		array(			'taxonomy' => 'product_tag',			'field' => 'slug',			'terms' => $line,			'operator' => 'IN',			)		),	);//$items = get_posts_fields( $args ); $items = get_posts( $args ); return $items; }?>