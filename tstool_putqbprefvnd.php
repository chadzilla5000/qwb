<?phprequire_once('inc/_init.php');require_once('inc/functions/general.php');if($lghsh['Id'] == 0){	require_once('inc/functions/authorization.php'); 	$pgcontent = logform(); 	}include_once 'inc/functions.php';include_once 'wconfig.php';setlocale(LC_MONETARY, 'en_US');error_reporting(E_ERROR | E_WARNING | E_PARSE);ini_set('memory_limit', '1024M');defined( 'ABSPATH' ) || exit;$st = 1001;$nd = 100000;$Queue = new QuickBooks_WebConnector_Queue($dsn, $qbwc_user); $bh = array();$thead = $trows = NULL;$tm = 0;		$thead = '	<tr><th></th>		<th style="font-size: 13px;" colspan="5">QB Product</th>		<th style="font-size: 13px;" colspan="2">Price</th>		<th style="font-size: 13px;" colspan="2">Account Ref.</th>		<th style="font-size: 13px;" colspan="2">Date / Time</th>	</tr>	<tr><th style="width: 50px;"></th>		<th style="width: 150px;">List ID</th>		<th style="width: 150px;">E-Seq.</th>		<th style="width: 250px;">Sku</th>		<th style="width: 700px;">Title</th>		<th style="width: 150px;">Vendor</th>		<th style="width: 70px;">Cost</th>		<th style="width: 70px;">Sale</th>		<th style="width: 130px;">Income</th>		<th style="width: 130px;">Expence</th>		<th style="width: 130px;">DT created</th>		<th style="width: 130px;">DT modified</th>	</tr>';		$fn = NI_ITEMS_XML;		if (!file_exists($fn)) { die("XML file not found"); }		$xml = simplexml_load_file($fn);		foreach($xml->QBXMLMsgsRs->ItemNonInventoryQueryRs->ItemNonInventoryRet as $d){ $tm++;			$tcreat = substr($d->TimeCreated,  0, 19);			$tmodif = substr($d->TimeModified, 0, 19);						if(($tm<$st OR $tm>$nd) OR $d->SalesAndPurchase->PrefVendorRef->FullName){ continue; }						$vendor = getqbvendor($d->SalesAndPurchase->SalesDesc); //echo $vendor.'<br>';			if($vendor){ ///////////////////////////			$bh['id'] = $idp;			$bh['QBListID'] = $d->ListID;			$bh['EdSeq'] = $d->EditSequence;			$bh['sku'] = $d->Name;			$bh['title'] = $d->SalesAndPurchase->SalesDesc;			$bh['vendor'] = $vendor;			$bh['sprice'] = $d->SalesAndPurchase->SalesPrice;			$bh['cost'] = $d->SalesAndPurchase->PurchaseCost;			$bh['IncAccRef'] = $d->SalesAndPurchase->IncomeAccountRef->FullName; //'Merchandise Sales';			$bh['ExpAccRef'] = $d->SalesAndPurchase->ExpenseAccountRef->FullName; //'Cost of Goods Sold';//$bh[1]->price = ($bh[1]->price) ? $bh[1]->price : 0;//*  /////     Disable adding query ////////////////////			 $newid = insItomod($bh);			 if($newid){ 				$Queue->enqueue(QUICKBOOKS_MOD_NONINVENTORYITEM, $newid);				}			}						$trows .= '	<tr><td>' . $tm.' . </td>		<td>' . $d->ListID . '</td>		<td>' . $d->EditSequence . '</td>		<td>' . $d->Name . '</td>		<td>' . $d->SalesAndPurchase->SalesDesc . '</td>		<td>' . (($d->SalesAndPurchase->PrefVendorRef)? $d->SalesAndPurchase->PrefVendorRef->FullName:NULL) . '</td>		<td>' . $d->SalesAndPurchase->PurchaseCost . '</td>		<td>' . $d->SalesAndPurchase->SalesPrice . '</td>		<td nowrap>' . (($d->SalesAndPurchase->IncomeAccountRef)?$d->SalesAndPurchase->IncomeAccountRef->FullName:NULL) . '</td>		<td nowrap>' . (($d->SalesAndPurchase->ExpenseAccountRef)?$d->SalesAndPurchase->ExpenseAccountRef->FullName:NULL) . '</td>		<td>' . $tcreat . '</td>		<td>' . $tmodif . '</td>	</tr>';					}	$pcnt = '<form method="post" action="listqbxml.php" name="DForm"><div style="margin-top: 25px;"><!-- div style="float: left;">&nbsp; &nbsp;<input type="button" name="xmlreq" value="Request XML" style="padding: 1px 5px;" OnClick="return requestqbinventoryxml();" /> &nbsp; &nbsp;</div><div style="float: right;">&nbsp; &nbsp;<input type="Submit" name="updb" value="Update DB" style="padding: 1px 5px;" /> &nbsp; &nbsp;</div --><div style="clear: both;"></div></div><table class="TBL" width="100%" cellspacing="1">'.$thead.''.$trows.'</table></form><script>function requestqbinventoryxml(){var url = "qbinventoryquery.php";var prt = perform(url); 	if(prt){alert(prt);}//	else{window.location.reload();}	return false;}function load_console(url, wd, ht){ //alert(url); return false;var	obj = document.getElementById("CConsole");var	pln = document.getElementById("consolink");	pln.href = url+"&cns=pf";	obj.style.display = "block";	obj.style.width = wd;	obj.style.height = ht;	query_srv(url, \'InConsole\');	return false;}function ClsConsole(){	document.getElementById("CConsole").style.display = "none";	return;}</script>';$pgtitle = '<h4>List</h4>';$pgcontent = <<<EOD__<!-- Page content start -->$pcnt<!-- Page content end -->EOD__;require_once('inc/_shell.php'); ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////function insItomod($h){ global $dbh;	//echo date('Y-m-d H:m:s', time()); return NULL;	$title = $h['title'];	$vendor = $h['vendor'];	$prc   = ($h['sprice']) ? $h['sprice'] : 0;	$cost  = ($h['cost']) ? $h['cost'] : 0;	$incacc = $h['IncAccRef'];	$expacc = $h['ExpAccRef'];	$que = "INSERT INTO wc_item ( QBListID, EdSeq, Sku, Title, PrefVnd, VCost, RPrice, SPrice, IncAccRef, ExpAccRef ) 		VALUES (			'" . mysqli_escape_string($dbh, $h['QBListID'] ) . "',			'" . mysqli_escape_string($dbh, $h['EdSeq'] ) . "',			'" . mysqli_escape_string($dbh, $h['sku'] ) . "',			'" . mysqli_escape_string($dbh, $title ) . "',			'" . mysqli_escape_string($dbh, $vendor ) . "',			'" . mysqli_escape_string($dbh, $cost ) . "',			'" . mysqli_escape_string($dbh, 0 ) . "',			'" . mysqli_escape_string($dbh, $prc ) . "',			'" . mysqli_escape_string($dbh, $incacc ) . "',			'" . mysqli_escape_string($dbh, $expacc ) . "'			)";//drc($que);	mysqli_query($dbh, $que);	return mysqli_insert_id($dbh);}function getqbvendor($ttl){if(preg_match('/^Cubitac/',				$ttl)){ return 'Cubitac Cabinetry'; }if(preg_match('/^CNC/',					$ttl)){ return 'CNC Cabinetry'; }if(preg_match('/^Forevermark/',			$ttl)){ return 'TSG'; }if(preg_match('/^GHI/',					$ttl)){ return 'Hornings Supply'; }if(preg_match('/^US Cabinet Depot/',	$ttl)){ return 'US Cabinet Depot'; }if(preg_match('/^Wolf/',				$ttl)){ return 'WOLF'; }return NULL;}?>