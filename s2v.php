<?phprequire_once('inc/_init.php');require_once('inc/functions/general.php');require_once('inc/skucreate_f.php');if($lghsh['Id'] == 0){	require_once('inc/functions/authorization.php'); 	$pgcontent = logform(); 	}include_once 'inc/functions.php';include_once 'wconfig.php';setlocale(LC_MONETARY, 'en_US');error_reporting(E_ALL | E_STRICT);//error_reporting(E_ERROR | E_WARNING | E_PARSE);///////////////////////////////////////////////////////////////////////////////$ln = (isset($_POST['prline']))?$_POST['prline']:'madison-latte';//$ln = 'madison-latte'; //(isset($_GET['br']))?$_GET['br']:NULL;$postp = NULL;$dflag = true;ini_set('memory_limit', '2048M');set_time_limit ( 5600 );$ofs = 0;$ppp  = -1;$attr = (isset($_POST['setattr']))?$_POST['setattr']:NULL;$srch = (isset($_POST['skusrch']))?$_POST['skusrch']:NULL;$brnd = (isset($_POST['brndsrch']) AND $_POST['brndsrch']) ? $_POST['brndsrch']:NULL;$brndsrch_optlist = array(	'<option value="aurafina">Aurafina</option>',	'<option value="cnc">CNC</option>',	'<option value="cubitac">Cubitac</option>',	'<option value="forevermark">Forevermark</option>',	'<option value="ghi">GHI</option>',	'<option value="msi">MSI</option>',	'<option value="us-cabinet-depot">USCD</option>',	);$stt = NULL;$osc = 0;$chbdsb = 'disabled';$wsiarr = getwsline_2($brnd, $srch);if(isset($_POST['fixtock']) AND $wsiarr){	$vs=0;	foreach($wsiarr as $it){		$probj = wc_get_product($it->ID);		if($probj->get_stock_status()=='outofstock'){			if($vs < 50){ 				put2stock($probj); $vs++; 				}			}		}	}if(isset($_POST['fsubmit'])){	$stt .= '<tr><td colspan="7">';	foreach($_POST as $k=>$sk){		if(preg_match('/(ps_)([\d]{3,9})/', $k, $m)){			$sku = crt_var($m[2], $attr);			$stt .= '<a target="_blank" href="'.SITE_URL.'/wp-admin/post.php?post='.$m[2].'&action=edit">'.$sku.'</a>&nbsp;';			}		if(preg_match('/(pr_)([\d]{3,9})/', $k, $m)){ 			$sku = crt_smp($m[2]);			$stt .= '<a target="_blank" href="'.SITE_URL.'/wp-admin/post.php?post='.$m[2].'&action=edit">'.$sku.'</a>&nbsp;';			}		}	$stt .= '</td></tr>';	}//else{//	$wsiarr = getwsline($ln, $ppp, $ofs); /// Get items array from website by brand name (Sku, Title, Regular price, Sale price) /////////////////if($wsiarr){	$di=$vd=0;	foreach($wsiarr as $it){		$probj = wc_get_product($it->ID);		// if($probj->get_stock_status()=='outofstock'){			// if(isset($_POST['fixstck']) AND $vs < 50){ put2stock($probj); $vs++; }			// }		$ststs = $probj->get_stock_status();		if($ststs=='outofstock'){ $osc++; }		if($osc){$chbdsb='';}		$rprice = cget_price($probj);				if($probj->is_type( 'variable' )){ $vd++;			$attr = NULL;			$pa_flg = NULL;			$attributes = $probj->get_attributes();				foreach($attributes as $attribute){				$attr .= $attribute->get_name().' ';				if(preg_match('/pa_srass/', $attr)){ //				fix_attr($probj); 				$pa_flg = 'checked'; 				}								}				$vids = join(', ', $probj->get_children());							// foreach($var_ids as $vid){				// $vids .= $vid.'&nbsp;&nbsp;';				// }						// $variations = $probj->get_available_variations();			// $var_ids = wp_list_pluck($variations, 'variation_id' );// $price = 0;//			foreach($var_ids as $vid){				//				$product_variation = new WC_Product_Variation($vid);//				$price = $product_variation->regular_price;//				echo $vid.'<br>';//				}	/* return variations id array *///	$variations_id 		= wp_list_pluck( $variations, 'variation_id' );	/* return variation attributes array *///	$attributes 		= $probj->get_variation_attributes();//	$attributesArray 	= wp_list_pluck( $variations, 'attributes' );//	foreach($attributesArray as $nameOfAttribute => $valueOfAttribute) {//		echo $nameOfAttribute.' - '.array_values($valueOfAttribute).'<br>';//		echo $valueOfAttribute[$nameOfAttribute].'<br>';//		}									$stt.= '<tr><td style="text-align: right; font: normal 11px \'Arial\'; background: #fc9; color: #999;">'.++$di.'.</td>						<td><img style="height: 30px; cursor: crosshair;" src="'.wp_get_attachment_url( $probj->get_image_id() ).'" OnMouseOver="z_zoom(this);" OnMouseOut="z_hide(this);" /></td>						<td><div style="float: left; width: 35px;">&nbsp;</div><a target="_blank" href="'.$it->guid.'">'.$it->post_title.'</a><input type="checkbox" name="pr_'.$it->ID.'" value="1" style="float: right; margin-right: 15px;" '.$pa_flg.' /></td>						<td>'.$ststs.'</td>						<td>'.$it->ID.'</td>						<td><a target="_blank" href="'.SITE_URL.'/wp-admin/post.php?post='.$it->ID.'&action=edit">'.$it->_sku.'</a></td>						<td><input type="text" name="prc_'.$it->ID.'" value="'.$rprice.'" /></td>						<td style="color: #c96;"><div style="color: #369;">'.$attr.'</div>'.$vids.'</td>					</tr>';			}		else{			$stt.= '<tr><td style="text-align: right; font: normal 11px \'Arial\'; background: #cfc; color: #999;">'.++$di.'.</td>						<td><img style="height: 30px; cursor: crosshair;" src="'.wp_get_attachment_url( $probj->get_image_id() ).'" OnMouseOver="z_zoom(this);" OnMouseOut="z_hide(this);" /></td>						<td><div style="float: left; width: 35px; text-align: center;"><input type="checkbox" name="ps_'.$it->ID.'" value="1" /></div><a target="_blank" href="'.$it->guid.'">'.$it->post_title.'</a></td>						<td>'.$ststs.'</td>						<td>'.$it->ID.'</td>						<td><a target="_blank" href="'.SITE_URL.'/wp-admin/post.php?post='.$it->ID.'&action=edit">' . $it->_sku.'</a></td>						<td><input type="text" name="prc_'.$it->ID.'" value="'.$rprice.'" /></td>						<td></td>					</tr>';						}		}	}$sbt = '<style>input{	border: none;	max-width: 50px;	padding: 2px 3px;}</style><form name="S2V" method="post" action=""><div style="position: fixed; top: 45px; width: 100%; height: 20px; padding: 7px; background: #ccc;">	<div style="float: left;">		<select name="brndsrch">			<option value="">Select Brand</option>'.getopts($brndsrch_optlist, $brnd).'		</select>&nbsp;&nbsp;&nbsp;	</div>	<div style="float: right; margin-right: 50px;">	<select name="setattr">		<option value="">Select Attribute</option>		<option value="AssemblyLR">AssemblyLR</option>		<option value="AssemblyRTA">AssemblyRTA</option>		<option value="SRAssembly">SRAssembly (Cubitac)</option>		<option value="SRAssemblyLR">SRAssemblyLR (Cubitac)</option>	</select>&nbsp;&nbsp;&nbsp;	<input style="max-width: 150px;" type="submit" name="fsubmit" id="fsubmit" value="Change Product Type"  OnClick="return chckforms();" />	</div>	<input style="max-width: 150px;" type="text" name="skusrch" value="'.$srch.'" />	<input style="max-width: 150px;" type="submit" name="list" id="list" value="List" />&nbsp;&nbsp;&nbsp;	<input style="max-width: 150px;" type="submit" name="fixtock" value="Fix Stock" '.$chbdsb.' /> '.$osc.'</div><div style="height: 38px;"></div><table class="TBL" width="100%" cellspacing="1"><tr><th></th>	<th style="width: 50px;">Image</th>	<th><span style="float: left;">Simple</span>Product Title<span style="float: right;">Variable</span></th>	<th style="width: 80px;">Status</th>	<th style="width: 80px;">Item ID</th>	<th style="width: 150px;">Sku</th>	<th style="width: 50px;">Price</th>	<th style="width: 150px;">Variations ID</th></tr>'.$stt.'</table></form><img id="zimg" style="position: fixed; top: 90px; left: 250px; max-height: 700px; border: solid 1px #009; border-radius: 12px; box-shadow: 5px 5px 15px; display: none; z-index: 5878" src="" /><script type="text/javascript">function z_zoom(o){var im = document.getElementById("zimg");	im.style.display = "block";	im.src = o.src;}function z_hide(o){var im = document.getElementById("zimg");	im.style.display = "none";}function chckforms(){var dms = 0;var dmv = 0;var markedCheckbox = document.querySelectorAll(\'input[type="checkbox"]:checked\');  	for (var checkbox of markedCheckbox) {		if(checkbox.name.match(/^ps_/g)){ dms = 1; }		if(checkbox.name.match(/^pr_/g)){ dmv = 1; }		}  	if(!dmv && !dms){ alert("Select Products to change"); return false;	}	if(dms && !S2V.setattr.value){	alert("Select Attribute to add to product\(s\)"); return false; }	return true;}</script>';$pgcontent = $sbt;$page_title       = 'WT UMS - Transform Simple Products to Variables';$hsct = 'smp2var';$page_description = '';$keywords         = '';$head_ext         = '';require_once('inc/_shell.php'); ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////function getwsline($line, $ppp, $offs){if(!$line){return NULL;}$inc=0;	$itarr = array();$args = array(	'post_type'             => 'product',	'post_status'           => 'publish',//	'fields' => 'ids',//	'fields' => 'sku',	'ignore_sticky_posts'   => 1,	'offset' 				=> $offs,	'posts_per_page'        => $ppp,	'tax_query' => array(		array(			'taxonomy' => 'product_tag',			'field' => 'slug',			'terms' => $line,			'operator' => 'IN',			)		),	);//$items = get_posts_fields( $args ); $items = get_posts( $args ); return $items; }function getwsline_2($brand, $skusrch){if(!$brand){ return NULL;}if(!$brand AND !$skusrch){ return NULL;}$taxqu = ($brand) ? array(	array(		'taxonomy' => 'product_tag',		'field' => 'slug',		'terms' => $brand,		'operator' => 'IN',		)	) : NULL;	$args = array(		'posts_per_page' => -1,		'post_status'     => 'publish',		'post_type'       => 'product',		'meta_query'      => array(			'sku_clause'  => array(				'key'     => '_sku',				'value'	  => $skusrch,				'compare' => 'LIKE',				)			),		'tax_query'       => $taxqu,		);	$items = get_posts( $args ); 	return $items; 	}function put2stock($obj){ $id = $obj->get_id();//	wc_update_product_stock($id, 1000);	update_post_meta( $id, '_manage_stock', "yes" );	update_post_meta( $id, '_backorders', "no" );	update_post_meta( $id, '_stock', 1000 );	$obj->save();	return;	}function fix_attr($obj){ $id = $obj->get_id();		$oname = NULL;	$attributes = $obj->get_attributes();		foreach($attributes as $attribute){		$oname = $attribute->get_name();//		echo $obj->get_id().' - '.$oname . ' - ';		}	$nname = (sizeof($obj->get_children())>2)?'SRAssemblyLR':'SRAssembly';//	echo $nname.'<br>';//if($id=='317946'){		crt_smp($id);	// $variations = $obj->get_available_variations();		// $var_ids = wp_list_pluck($variations, 'variation_id' );		// foreach($var_ids as $vid){			// $product_var_obj = new WC_Product_Variation($vid);			// $product_var_obj->delete();			// }		// update_post_meta( $id, '_product_attributes', NULL);	crt_var($id, $nname);	put2stock($obj);//	}}?>