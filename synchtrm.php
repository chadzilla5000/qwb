<?phpinclude_once('inc/_init.php');include_once('inc/functions/general.php');error_reporting(E_ALL | E_STRICT);$page_description = '';$keywords         = '';$head_ext         = '';$page_title       = 'Unified WC Terminal';if($lghsh['Id'] == 0){	require_once('inc/functions/authorization.php'); 	$pgcontent = logform(); 	$page_title = 'WC Terminal LogIn';	require_once('inc/_shell.php'); ///	exit;	}include_once 'inc/functions.php';setlocale(LC_MONETARY, 'en_US');$ords = $msg = NULL;include_once 'wconfig.php';$tinf = $bdy = NULL;$pcnt = NULL;$upd_ed = $ins_ed = 0;$inc=0;ini_set('memory_limit', '1024M');//$items = websitems_1();//echo '<pre>'; print_r($items); echo '</pre>';$ink=0;$brndsrch_optlist = array(	'<option value="cubitac">Cubitac</option>',	'<option value="feather-lodge">Feather Lodge</option>',	'<option value="forevermark">Forevermark</option>',	'<option value="ghi">GHI</option>',	'<option value="msi">MSI</option>',	'<option value="us-cabinet-depot">USCD</option>',	);$brand = (isset($_POST['brndsrch']))?$_POST['brndsrch']:'US-Cabinet-Depot';if($brand){   ////////////        Items update   //////////////////////////////////////////////////////////	$wsiarr = websitems_1($brand); /// Get items array from website by brand name (Sku, Title, Regular price, Sale price) /////////////////	foreach($wsiarr as $wsarr){ //$inc_all++; // Cycle begin /////////////////////////////////////////////////////		$prod = wc_get_product($wsarr->ID);		if($prod){			$bdy.='<tr><td style="color: #999;">'.++$inc.'</td>	<td></td>	<td>'.$wsarr->_sku.'</td>	<td style="font-size: 9px;">'.$wsarr->post_title.'</td>	<td style="text-align: right;">'.$wsarr->_regular_price.'</td>	<td style="width: 150px; border-right: solid 2px #f00;"></td>	<td style="width: 200px;color: #999;"></td></tr>';				if($prod->is_type('variable')){ //// For variables items  ////////////////////				foreach($prod->get_available_variations() as $var){					$vard = wc_get_product($var['variation_id']);								$vsku = $vard->get_sku();					$bdy.='<tr><td style="color: #999;">'.++$inc.'</td>	<td></td>	<td style="text-align: right;">'.$vsku.'</td>	<td></td>	<td style="text-align: right;"></td>	<td style="width: 150px; border-right: solid 2px #f00;"></td>	<td style="width: 200px;color: #999;"></td></tr>';						}				}			}		}  // Cycle end  ////////////////////////////////////////////////////////////////////	$pcnt = '<style>#TopLn{	width: 100%;	height: 20px;	background: #009; 	background-image: linear-gradient(to left, #012, #09c); 	padding: 3px 0px; 	color: #fff;}.vcell{ padding: 1px 3px; background: #fff;}.vcell:first-child {	background: #555; color: #aa9; text-align: right;	min-width: 140px;			}#LTbl td{	padding: 2px 5px;	font: normal 11px "Tahoma";}#LTbl tr:nth-child(odd){  background-color: #eee;}#rsrchdirection:hover{	text-decoration: underline;	}</style><form method="post" name="bfmm31" action="#"><select name="brndsrch"><option value="">Brand</option>'.getopts($brndsrch_optlist, $brand).'</select>&nbsp; &nbsp;<input type="submit" name="submitdt" value="List items" style="padding: 1px 5px;" />&nbsp; &nbsp;<table id="LTbl" cellspacing="1"><tr><th></th>	<th style="border: solid 1px #f60; border-width: 1px 0px 0px 2px; color: #f60;"></th></tr><tr><th></th>	<th></th>	<th style="width: 250px;"></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th></tr>'.$bdy.'</table></form>';	}//if(isset($_GET['qup']) AND $_GET['qup']=='item'){   ////////////        Items update   ////////////////////////////////////////////////////////////if(isset($_POST['upd_consolisku'])){   ////////////        Items update   //////////////////////////////////////////////////////////if(0){   ////////////        Items update   //////////////////////////////////////////////////////////$brand = 'US-Cabinet-Depot';$wsiarr = getwsitems2($brand); /// Get items array from website by brand name (Sku, Title, Regular price, Sale price) /////////////////	$st1 = $st2 = NULL;//	$vw[0] = 'WCWeb'; $vw[1] = 'Vendor';//	if($mcls==1){ $sbm_bttn = '<input type="submit" name="sku_unpub" value="Unpublish Sku" style="padding: 3px 9px;" />'; }	if($brand){		foreach($wsiarr as $wsk=>$wsarr){ //$inc_all++; // Cycle begin /////////////////////////////////////////////////////			$prf = 'TDW';			$mfx = NULL;			$sfx = NULL;			if(1){ //(preg_match("/^($prf-)(\w.*)/",$wsarr['sku'],$m)){//echo $wsarr['sku'].'<br>';//				if(chckSku($wsarr['sku'])){ continue; }  /// Omit existing records/////////				if(preg_match("/^(U-[\w]{2})(-)(\w.*)/",$wsarr['sku'],$m)				OR preg_match("/^([\w]{3})(-)(\w.*)/",$wsarr['sku'],$m)){//					echo $m[1].' - '.$m[2].'<br>';$bsk = $wsarr['sku'];$q = "INSERT INTO wc_consolisku( Sku_WC, Vendor, Sku_2020, Style_2020, Asm	) 							VALUES ( 							'$bsk',							'GHI',							'$m[3]',							'$m[1]',							'')";//					mysqli_query($dbh, $q) or die("DB update failed: " . mysqli_connect_error());				}//				$Pr_ID  = wc_get_product_id_by_sku($wsarr['sku']);//				$prod = wc_get_product($Pr_ID);				$prod = wc_get_product($wsarr['id']);				if($prod){//				if(1){//				ins2csku($wsarr['sku'], $mfx, $prf, $sfx);      ///////////////////      Inserts to table //////////////////////////					$bdy.='<tr><td style="color: #999;">'.++$inc.'</td>	<td></td>	<td style="'.$st1.'">'.$wsarr['sku'].'</td>	<td style="'.$st1.'">'.$wsarr['title'].'</td>	<td style="text-align: right;">'.$wsarr['rprice'].'</td>	<td style="width: 150px; border-right: solid 2px #f00;"></td>	<td style="width: 200px;color: #999;"></td></tr>';						if($prod->is_type('variable')){ //// For variables items  ////////////////////					//					echo $wsarr['sku'].'<br>';											foreach($prod->get_available_variations() as $var){							$sfx = NULL;							$vard = wc_get_product($var['variation_id']);										$vsku = $vard->get_sku();//							if(preg_match("/^($prf-)(\w.*)(-)([\w]{3,5})$/",$vsku,$mv)){if(1){//								$sfx = $mv[4];												//							ins2csku($vsku, $mv[2], $prf, $sfx);   ///////////////////      Inserts to table //////////////////////////																$bdy.='<tr><td style="color: #999;">'.++$inc.'</td>	<td></td>	<td style="text-align: right;">'.$vsku.'</td>	<td style="'.$st1.'"></td>	<td style="text-align: right;"></td>	<td style="width: 150px; border-right: solid 2px #f00;"></td>	<td style="width: 200px;color: #999;"></td></tr>';									}							}						}																	}				}			}  // Cycle end  ////////////////////////////////////////////////////////////////////		}$pcnt = '<style>#TopLn{	width: 100%;	height: 20px;	background: #009; 	background-image: linear-gradient(to left, #012, #09c); 	padding: 3px 0px; 	color: #fff;}.vcell{ padding: 1px 3px; background: #fff;}.vcell:first-child {	background: #555; color: #aa9; text-align: right;	min-width: 140px;			}#LTbl td{	padding: 2px 5px;	font: normal 11px "Tahoma";}#LTbl tr:nth-child(odd){  background-color: #eee;}#rsrchdirection:hover{	text-decoration: underline;	}</style><form method="post" name="bfmm31" action="#"><table id="LTbl" cellspacing="1"><tr><th></th>	<th style="border: solid 1px #f60; border-width: 1px 0px 0px 2px; color: #f60;"></th></tr><tr><th></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th>	<th></th></tr>'.$bdy.'</table></form>';}//	$fn = "data/sinchro/noninvitems_$page_title = 'WS';$hsct = 'qbsnch';$pgcontent = <<<EOD__<!-- Page content start -->$pcnt<!-- Page content end -->EOD__;require_once('inc/_shell.php'); /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////function checkxst($sku){ global $dbh;	$q = "SELECT id FROM qw_item_tst WHERE Sku='$sku'";	$result = mysqli_query($dbh, $q);	if($result->num_rows){ return 1; }	return 0;	}function chckSku($sku){ global $dbh;	$q = mysqli_query($dbh, "SELECT id FROM wc_consolisku WHERE Sku_WC='$sku'") or die('Error: ' . mysqli_error($dbh));	return mysqli_num_rows($q);}function websitems_1($brnd){$lmt = -1;	$ofs = 0;$asds = 'DESC';$dto = '2021-10-12 12:59';$dfr = '2014-10-12 12:59';$skusrch = (isset($_POST['skusrch']) AND strlen($_POST['skusrch'])>=2) ? $_POST['skusrch']:NULL;		$args = array(	'posts_per_page' => $lmt,	'offset'         => $ofs,	'post_status'    => 'publish',	'post_type'      => 'product',	'orderby'        => 'date',	'order'          => $asds,	'meta_query'     => array(		'sku_clause'  => array(			'key'     => '_sku',			'value'	  => $skusrch,			'compare' => 'LIKE',			)		),	'tax_query'      => array(		array(			'taxonomy' => 'product_tag',			'field' => 'slug',			'terms' => $brnd,			'operator' => 'IN',			)		),	'date_query'     => array(		'column'      => 'post_modified',		'before'      => $dto.' + 1 days',		'after'       => $dfr.' + 0 days',		'type'        => 'date'		)	);return get_posts( $args ); }?>