<?phprequire_once('inc/_init.php');require_once('inc/functions/general.php');error_reporting(E_ALL | E_STRICT);if($lghsh['Id'] == 0){	require_once('inc/functions/authorization.php'); 	$pgcontent = logform(); 	$page_title       = 'WC Terminal LogIn';	$page_description = '';	$keywords         = '';	$head_ext         = '';	require_once('inc/_shell.php'); ///	exit;	}include_once 'inc/functions.php';setlocale(LC_MONETARY, 'en_US');$lwh = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);//ini_set('memory_limit', '84M');require_once 'wconfig.php';if(isset($_POST['blkremove'])){	foreach($_POST as $chk=>$chv){		if(preg_match('/chb2r_/',$chk)){			wp_trash_post($chv); /// WooC function to trash selected ID items ///			}		}	}$intbl = NULL;$inc=$ii=0;$brndsrch_optlist = array(	'<option value="aurafina">Aurafina</option>',	'<option value="cnc">CNC</option>',	'<option value="cubitac">Cubitac</option>',	'<option value="feather-lodge">Feather Lodge</option>',	'<option value="forevermark">Forevermark</option>',	'<option value="ghi">GHI</option>',	'<option value="msi">MSI</option>',	'<option value="us-cabinet-depot">USCD</option>',	);$brslg = (isset($_POST['brndslct']) AND $_POST['brndslct'])?$_POST['brndslct']:'---';$wsarr = array();$rs = getWCprodata($lwh);while($r = mysqli_fetch_assoc($rs)){	$wsarr[$r['id']]=$r['sku'];	}	foreach($wsarr as $k=>$v){		//		echo $k. ' - '. $v.'<br>';	}$gstyle = '#090';/////////////////////////////    Loooong main query ///////////////////////////////////////////////////////$que = mysqli_query($lwh, "SELECT t1.ID AS id, t1.post_title AS title, t2.meta_value AS sku, COUNT(t2.meta_value) FROM wp_posts AS t1 INNER JOIN wp_postmeta AS t2 ON t1.ID = t2.post_id  WHERE t1.post_type='product' AND t1.post_status='publish' AND t2.meta_key='_sku' GROUP BY UPPER(t2.meta_value) HAVING COUNT(t2.meta_value) > 1");//$que = mysqli_query($lwh, "SELECT t1.ID AS id, t1.post_title AS title, t2.meta_value AS sku FROM wp_posts AS t1 INNER JOIN wp_postmeta AS t2 ON t1.ID = t2.post_id WHERE (t1.post_type='product' OR t1.post_type='product_variation') AND t2.meta_key='_sku'");//$que = mysqli_query($lwh, "SELECT t1.ID AS id, t1.post_title AS title, t2.meta_value AS sku FROM wp_posts AS t1 JOIN wp_postmeta AS t2 ON t1.ID=t2.post_id WHERE t1.post_type='product' AND t2.meta_key='_sku' GROUP BY t2.meta_value HAVING COUNT(UPPER(t2.meta_value))>1");//$que = mysqli_query($lwh, "SELECT * FROM wp_posts WHERE post_type='product' AND post_status='publish'");$q = "SELECT t1.ID AS id, t1.post_title AS title, t2.meta_value AS sku FROM wp_posts AS t1 INNER JOIN wp_postmeta AS t2 ON t1.ID = t2.post_id WHERE (	t1.post_type='product' OR t1.post_type='product_variation') AND 		t1.post_status='publish' AND 		t1.post_name LIKE '$brslg%' AND 		t2.meta_key='_sku'		";$result = getWCprodata($lwh, $brslg);//$res = mysqli_query($lwh, $q);while($row = mysqli_fetch_assoc($result)){ $ii++;	foreach($wsarr as $k=>$v){		if($row['sku']==$v AND $row['id']!=$k){			echo $v.'<br>';			}//		echo $k. ' - '. $v.'<br>';		}// $sq = "// SELECT t2.post_id AS id FROM wp_postmeta AS t2 INNER JOIN wp_posts AS t1 ON t1.ID = t2.post_id // WHERE (	t1.post_type='product' OR t1.post_type='product_variation') AND 		// t1.post_status='publish' AND 		// t2.meta_key='_sku' AND		// t2.meta_value='$row[sku]' AND 		// t2.post_id!='$row[id]'		// ";// if(mysqli_fetch_row(mysqli_query($lwh, $sq))){// echo 'fount duplication <br>';	// }//	$dsku = strtoupper($row['sku']);//	$gstyle = ($gstyle=='#09c')?'#f00':'#09c';		$intbl .= '<tr><td style="font-size: 9px; color: #999;">'.++$inc.'. </td>	<td>'.$row['id'].'</td>	<td>'.$row['sku'].'</td>	<td>'.$row['title'].'</td>	<td></td>	<td></td>	<td></td></tr>';/*	////////////  Sub query ////////////////////////////	$q2 = mysqli_query($lwh, "SELECT st1.post_id AS subid, st2.post_title AS subttl, st2.guid AS guid FROM wp_postmeta AS st1 INNER JOIN wp_posts AS st2 ON st1.post_id = st2.ID WHERE st1.meta_key='_sku' AND UPPER(st1.meta_value)='$dsku'");	while($r2 = mysqli_fetch_assoc($q2)){		$prr = mysqli_fetch_assoc(mysqli_query($lwh, "SELECT meta_value FROM wp_postmeta WHERE meta_key='_regular_price' AND post_id='$r2[subid]'"))['meta_value'];		$prs = mysqli_fetch_assoc(mysqli_query($lwh, "SELECT meta_value FROM wp_postmeta WHERE meta_key='_sale_price' AND post_id='$r2[subid]'"))['meta_value'];		$prc = mysqli_fetch_assoc(mysqli_query($lwh, "SELECT meta_value FROM wp_postmeta WHERE meta_key='_price' AND post_id='$r2[subid]'"))['meta_value'];		$intbl .= '<tr><td style="font-size: 9px; color: #999;">'.++$inc.'. </td>	<td><a target="_blank" href="https://www.waverlycabinets.com/wp-admin/post.php?post='.$r2['subid'].'&action=edit">'.$r2['subid'].'</a>	<input type="checkbox" name="chb2r_'.$row['sku'].'_'.$r2['subid'].'" value="'.$r2['subid'].'" style="float: right;" OnClick="hndlchb(this);" /></td>	<td style="color: '.$gstyle.';">'.$row['sku'].'</td>	<td><a target="_blank" href="'.$r2['guid'].'">'.$r2['subttl'].'</a></td>	<td>'.$prr.'</td>	<td>'.$prs.'</td>	<td>'.$prc.'</td></tr>';		}//////////////////  */							}		$pcnt = '<style></style><form method="post" action="#" name="dblremf" OnSubmit="return askconfirm();"><table class="TBL" width="100%" cellspacing="1" style="font: normal 10px \'Arial\'"><tr><th colspan="3" style="font-size: 15px; color: #ccc;">Duplicates ('.$ii.')</th>	<th><select name="brndslct" OnChange="this.form.submit();"><option value="">Brand</option>'.getopts($brndsrch_optlist, $brslg).'</select>&nbsp; &nbsp;	</th>	<th colspan="3">Price</th></tr><tr><th></th>	<th>ID</th>	<th>Sku</th>	<th>Title</th>	<th>Regular</th>	<th>Sale</th>	<th>_price</th></tr>'.$intbl.'</table><input type="submit" name="blkremove" id="blkremove" value="Trash Selected" style="margin: 10px 15px; padding: 1px 5px;" disabled /></form><script>function hndlchb(o){	var subtn = document.getElementById("blkremove");	subtn.disabled = true;	var inputElements = document.getElementsByTagName("input");	for (var i = 0; i < inputElements.length; i++){		if (inputElements[i].type == "checkbox"){			if (inputElements[i].checked){ subtn.disabled = false; }			}		}}function askconfirm(){	if(confirm("Are you sure you want to send selected items to trash?")){ return true; }	return false;}</script>';$page_title = 'Duplicates on Web Site';$head_ext = '';$hsct = '';$pgcontent = <<<EOD__<!-- Page content start -->$pcnt<!-- Page content end -->EOD__;require_once('inc/_shell.php'); ///?>