<?phprequire_once('inc/_init.php');require_once('inc/functions/general.php');error_reporting(E_ALL | E_STRICT);if($lghsh['Id'] == 0){	require_once('inc/functions/authorization.php'); 	$pgcontent = logform(); 	$page_title       = 'WC Terminal LogIn';	$page_description = '';	$keywords         = '';	$head_ext         = '';	require_once('inc/_shell.php'); ///	exit;	}include_once 'inc/functions.php';setlocale(LC_MONETARY, 'en_US');$msg = NULL;	require_once 'wconfig.php';error_reporting(E_ERROR | E_WARNING | E_PARSE);/*//////////// Form handler ////////////////////////////////////////////////////if(isset($_POST['fsbm'])){	$Queue = new QuickBooks_WebConnector_Queue($dsn, $qbwc_user); 	if($_POST['customer2send']){ ///////////   Preparing customer(s) to send ///////		foreach($_POST['customer2send'] as $sv){			$newid = insertCustomer($sv);			$Queue->enqueue(QUICKBOOKS_ADD_CUSTOMER, $newid);			}		$msg .= 'Customer(s) checked';		}		if($_POST['order2send']){ ///////////   Preparing order(s) along with items included to send ///////		foreach($_POST['order2send'] as $sv){	echo $sv . '<br>';		//			$newid = insertOrder($sv);			// if($_POST['ordest_'.$sv]=='Est') { $Queue->enqueue(QUICKBOOKS_ADD_ESTIMATE, $newid); }			// else							 { $Queue->enqueue(QUICKBOOKS_ADD_SALESORDER, $newid); }			}		$msg .= 'Order(s) checked';		}		if($_POST['payment2send']){ ///////////   Preparing payment(s) to send ///////		foreach($_POST['payment2send'] as $sv){						}		$msg .= 'Payment(s) checked';		}	$msg .=($msg)?'':'No data to send to QB';	}/////////*/$oid = $om = NULL;////////////////////////////////////////////////////////////////////if(!isset($_GET['oid'])) { die('Missing or invalid order ID'); }else { $oid = $_GET['oid']; }///////// Get order object$order = ($oid) ? new WC_Order($oid) : NULL;// $orr = wc_get_order( $oid );// echo '<pre>';// print_r($orr);// echo '</pre>';/*// Get the $order object from an ID (if needed only)$ord = wc_get_order( $oid);// Loop through order line itemsforeach( $ord->get_items() as $item ){    // get order item data (in an unprotected array)    $item_data = $item->get_data();    // get order item meta data (in an unprotected array)    $item_meta_data = $item->get_meta_data();    // get only All item meta data even hidden (in an unprotected array)    $formatted_meta_data = $item->get_formatted_meta_data( '_', true );    // Display the raw outputs (for testing)	foreach ($item_meta_data as $bk=>$bv){    echo $bk . ' - ' . $bv . '<br>';	}echo '<br><br><br> Juoru <br><br>';	foreach ($item_data as $bck=>$bcv){    echo $bck . ' - ' . $bcv . '<br>';	}//    echo '<pre>'; print_r($formatted_meta_data); echo '</pre>';}$dob = get_post_meta( $oid, FALSE, TRUE);	foreach ($dob as $bk=>$bv){		echo $bk . ' - ' . $bv[0] . '<br>';		if($bk == 'meta_data'){			foreach ($bv[0] as $bck=>$bcv){				echo $bck . ' ] - [ ' . $bcv . '<br>';				}			}		}echo '<br><br><br><br><br><br><br><br>';$sale_price = 0;$discountchart = get_option('waverly_pricing_settings');//$discountchart = get_option();//      if ( isset($discountchart['Forevermark']) ) {//        $sale_price = floatVal( $discountchart['Forevermark'] );//      }//      if ( isset($discountchart['Forevermark']) ) {//        $sale_price = floatVal( $discountchart['Cubitac'] );//      }        $sale_price = floatVal( $discountchart['tariff_cubitac'] );echo ' - ' . $sale_price;echo '<br><br><br><br><br><br><br><br>';*///get_order_details($oid);	$shipdiff = (		($om['_shipping_first_name'][0] != '' AND $om['_shipping_first_name'][0] != $om['_billing_first_name'][0]) OR		($om['_shipping_last_name'][0]  != '' AND $om['_shipping_last_name'][0]  != $om['_billing_last_name'][0])  OR		($om['_shipping_address_1'][0]  != '' AND $om['_shipping_address_1'][0]  != $om['_billing_address_1'][0])  OR		($om['_shipping_city'][0]       != '' AND $om['_shipping_city'][0]       != $om['_billing_city'][0])       OR		($om['_shipping_state'][0]      != '' AND $om['_shipping_state'][0]      != $om['_billing_state'][0])      OR		($om['_shipping_postcode'][0]   != '' AND $om['_shipping_postcode'][0]   != $om['_billing_postcode'][0])) ?		 $om['_shipping_first_name'][0] . ' ' . 		 $om['_shipping_last_name'][0]  . ' ' . 		 $om['_shipping_address_1'][0]  . ' ' . 		 $om['_shipping_city'][0]       . ' ' . 		 $om['_shipping_state'][0]      . ' ' . 		 $om['_shipping_postcode'][0]   : '<label style="color: #999;">Same as billing</lable>';	if( !$om['_billing_email'][0] ) { $shipdiff = ''; }$styleadd=($order->customer_note)?'border-right: double 5px #00c; cursor: pointer;':'';$jspp = ($order->customer_note)?'OnMouseOver="pupnote(this);" OnMouseOut="pclsnote(this);"':'';//$ord->order_date$itemsfrm = '';// Get and Loop Over Order Itemsforeach ( $order->get_items() as $item_id => $item ) {	$product_id   = $item->get_product_id();	$variation_id = $item->get_variation_id();	$product      = $item->get_product();	$name         = $item->get_name();	$quantity     = $item->get_quantity();	$subtotal     = $item->get_subtotal();	$total        = $item->get_total();	$tax          = $item->get_subtotal_tax();	$taxclass     = $item->get_tax_class();	$taxstat      = $item->get_tax_status();	$allmeta      = $item->get_meta_data();	$somemeta     = $item->get_meta( '_whatever', true );	$type         = $item->get_type();$sku = $p_id = NULL;if( $product->is_type( 'variable' ) ) { 	$sku     = $product->sku . '-RTA'; 	$p_id    = productId_by_sku($sku);	if(!$p_id){ // In case if "SR" sku handled incorrectly		$sku     = $product->sku . '-SR'; 		$p_id    = productId_by_sku($sku);		}	$product = wc_get_product($p_id);	$name    = $product->name;	}//print_r($allmeta);/*		foreach($allmeta as $sk=>$sv){	echo $sk . ' - ' . $sv . '<br>';					}*///	$name = preg_replace('/\&/', 'and', $name);//echo $product_id.' - '.$name . '<br>';//echo $allmeta[0] . '<br><br><br>';//	echo $product . '<br><br><br>';//print_r($allmeta)['timezone_type'][0];     $itemsfrm .= '<tr><td style="text-align: center;">'.$quantity.'</td>	<td>'.$product->sku.'</td>	<td>'.$product->attribute_summary.'</td>	<td>'.$name.'</td>	<td style="text-align: right;">$'.number_format((float) $product->regular_price, 2).'</td>	<td style="text-align: right;">$'.number_format((float) $product->price, 2).'</td>	<td style="text-align: right;">$'.number_format((float) $subtotal, 2).'</td></tr>      ';}/*	<td style="text-align: right;">$'.number_format((float) $product->regular_price, 2).'</td>	<td style="text-align: right;">$'.number_format((float) $product->price, 2).'</td>	<td style="text-align: right;">$'.number_format((float) $subtotal, 2).'</td>*/$phone = trtphonum($order->get_billing_phone(), $f);$stdprttl = $order->get_subtotal();$discnt   = $order->get_discount_total();$netsbf   = $stdprttl - $discnt;$freight  = $order->get_shipping_total();$frdiscnt = 0;$netsbtx  = $netsbf + $freight - $frdiscnt;$sttax    = $order->get_total_tax();$optlist = allqbcustomers();$c = get_coupon($order);// echo '<pre>';// print_r($c);// echo '</pre>';// $coups = $order->get_used_coupons();// foreach( $coups as $coup ) {// $tcoup = new WC_Coupon($coup);// drc($tcoup);// }// $coupons  = $order->get_coupon_codes();// $dscoups = NULL;// foreach( array_reverse($coupons) as $coupon_code ) {	// //	insertSubtotal($sv);// //	insertCouponDiscount($coupon_code, $sv);	// }//echo ($c->code)?$c->code:'None';// $coupons  = $order->get_used_coupons();// $coupons  = count($coupons) > 0 ? implode(',', $coupons) : '';// $c = new WC_Coupon($coupons);// echo "Discount Amount ".$c->amount."<br>";//Get Discount amount// echo "Discount Type ".$c->discount_type."<br>";//Get type of discount// echo "Individual Use ".$c->individual_use."<br>";//Get individual use status// echo "Usage Count ".$c->usage_count."<br>";//Get number of times the coupon has been used// echo "Uage Limit ".$c->usage_limit."<br>";//Get usage limit// echo "Coupon Description ".$c->description."<br>";//Get coupon description$uname = preg_replace("/\s/", '_', $lghsh['Name']);$flname = $order->get_billing_last_name() . '_'. $order->get_billing_first_name() . '_waverly_W-' . $oid .'_'.date('Y-m-d').'__'.$uname.'.pdf';$prinstructions = ($_GET['cns']=='pf')?'		<div style="float: left; margin: 10px 7px; font-size: 15px; color: #399; text-align: left;">		To save this page as ".pdf" follow steps below:<br>After you open "Print dialog" by <br>clicking button - <input type="button" name="b14" value="Open print" OnClick="window.print();" style="padding: 1px 5px; color: #339;" />&nbsp;&nbsp;or by right click and choose "Print", select: <br>Destination - "Save as PDF"<br>More settings:<br>Paper size - "A3"<br>Options - uncheck "Headers and footers" checkbox, <br>Hit "Save" and choose appropriate subfolder in "Jobs Quoted and Sold" folder<br>Review the filename "file...name.pdf" and Click "Save"		</div>			<div style="float: right;">'.$flname.'</div>':NULL;$pcnt = '<style>#TRght, #TBase, #TList{	width: 100%; background: #999;	}#TRght td, #TBase td, #TList td{	 background: #fff;	 padding: 5px;	}#TBase{ margin-top: 50px;}	.LRB{	width: 45%;	height: 230px;	border: solid 1px #333;	padding: 9px 15px;	background: #fff;	font-size: 17px;}.TSP01{	width: 70%;	text-align: right;	font-size: 15px;	color: #999;}#cstsrchresults{	position: absolute;	display: none;	width: 562px;	padding: 3px 7px;	background: #ffc;	border: dotted 1px #fc0;	border-radius: 0px 0px 9px 9px;	z-index: 3470;}#cstsrchresults a{ cursor: pointer; }#cstsrchresults a:hover{ font-weight: bold; }</style><div style="width: 80%; margin: 0 auto; margin-top: 10px; padding: 5px;"><div style="float: left; width: 300px; font: normal 15px \'Arial\'"><b>Waverly Cabinets</b><br>345 Enterprise Way<br>Pittston, PA 18640<br>570-693-0285<br>sales@waverlycabinets.com<br></div><div style="float: right; width: 370px;"><h2>Sales Receipt</h2><br><table id="TRght" cellspacing="1"><tr><td style="width: 70%;">Date / Time</td>	<td>Order #</td></tr><tr><td>'.$order->get_date_created().'</td>	<td>'.$oid.'</td></tr></table></div><div id="manualsel" style="margin-top: 20px; float: left;"><form action="qbw.php" method="post" name="ordersendman"><input type="hidden" name="fsbm" value="1" /><input type="hidden" name="singlorder" value="'.$oid.'" /><select name="ordest_'.$oid.'" style="font-size: 12px;" title="Send to QB as">	<option value="Est">Estimate</option>	<option value="Ord" selected>Order</option></select><input type="submit" name="manualsendorder" value="Send to " /><select name="manualcustomerselect" id="manualcustomerselect"><option value="">Select customer</option>'.$optlist.'</select><input type="text" name="srchcstm" value="" placeholder="Search customer" OnKeyUp="srchc(this);" style="width: 120px;" /><div id="cstsrchresults">&nbsp;</div></form></div><div style="clear: both; height: 35px;"></div><div class="LRB" style="float: left;"><h2>Bill To</h2>'.$order->get_formatted_billing_address().'<br><br>Email: '.$order->get_billing_email()      .'<br>Phone: '.$phone.'<br></div><div class="LRB" style="float: right;"><h2>Ship To</h2> <div style="float: right;"><a href="'.$order->get_shipping_address_map_url( ).'" target="_blank">Map</a></div>'.$order->get_formatted_shipping_address().'<br><br>Phone: '.$phone.'<br></div><div style="clear: both;"></div><table id="TBase" cellspacing="1"><tr><td style="width: 70%;">Payment Method</td>	<td>Project</td></tr><tr><td>'.$order->get_payment_method().'</td>	<td>'.$order->get_billing_last_name().'</td></tr></table><table id="TList" cellspacing="1"><tr><td style="width: 5%;">Qtty</td>	<td>Item Code</td>	<td>Assembly</td>	<td>Description</td>	<td>List Price</td>	<td>Std. Price</td>	<td>Total</td></tr>'.$itemsfrm.'<tr><td colspan="4" rowspan="2" style="vertical-align: middle;"><b>Notes:</b> '.$order->customer_note.'</td>	<td rowspan="2" style="vertical-align: middle;">List Total: </td>	<td colspan="2" style="text-align: right;">		<table style="width: 100%">			<tr><td class="TSP01">Std Price Total:</td>				<td>$'.number_format($stdprttl, 2).'</td>			</tr>						<tr><td class="TSP01">Discounts/Coupons: <span style="cursor: pointer; font-weight: bold; color: #003;" title="Discount '.$c->discount_type.' - '.$c->amount.'">'.$c->code.'</span></td>				<td>$'.number_format($discnt, 2).'</td>			</tr>			<!-- tr><td class="TSP01">Other Discount:</td>				<td>								'.								'--'								.'												</td>			</tr -->			<tr><td class="TSP01">Net Sale Before Freight:</td>				<td>$'.number_format($netsbf, 2).'</td>			</tr>			<tr><td class="TSP01">Freight:</td>				<td>$'.number_format($freight, 2).'</td>			</tr>			<tr><td class="TSP01">Net Sale Before Tax:</td>				<td>$'.number_format($netsbtx, 2).'</td>			</tr>		</table>	</td></tr><tr><td colspan="2" style="text-align: right;">		<table style="width: 100%">			<tr><td class="TSP01">Tax (6.0%):</td>				<td>$'.number_format($sttax, 2).'</td>			</tr>			<tr><td class="TSP01"><b>Total Cost:</b></td>				<td><b>'.$order->get_formatted_order_total().'</b></td>			</tr>		</table>	</td></tr></table><div style="clear: both; text-align: right;"></div>'.$prinstructions.'</div><script>document.title = "'.$flname.'";</script>';//echo '<pre>'; print_r($c); echo '</pre>';$pgtitle = '<h4>Order Summary</h4>';$ccontent = <<<EOD__<!-- Page content start -->$pcnt<!-- Page content end -->EOD__;//echo $pgcontent;//exit;$page_title       = 'WC Terminal - Order review';$page_description = '';$keywords         = '';$head_ext         = '';	require_once('inc/_Cshell.php'); /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////function get_order_details($order_id){    // 1) Get the Order object    $order = wc_get_order( $order_id );    // OUTPUT    echo '<h3>RAW OUTPUT OF THE ORDER OBJECT: </h3>';    print_r($order);    echo '<br><br>';    echo '<h3>THE ORDER OBJECT (Using the object syntax notation):</h3>';    echo '$order->order_type: ' . $order->order_type . '<br>';    echo '$order->id: ' . $order->id . '<br>';    echo '<h4>THE POST OBJECT:</h4>';    echo '$order->post->ID: ' . $order->post->ID . '<br>';    echo '$order->post->post_author: ' . $order->post->post_author . '<br>';    echo '$order->post->post_date: ' . $order->post->post_date . '<br>';    echo '$order->post->post_date_gmt: ' . $order->post->post_date_gmt . '<br>';    echo '$order->post->post_content: ' . $order->post->post_content . '<br>';    echo '$order->post->post_title: ' . $order->post->post_title . '<br>';    echo '$order->post->post_excerpt: ' . $order->post->post_excerpt . '<br>';    echo '$order->post->post_status: ' . $order->post->post_status . '<br>';    echo '$order->post->comment_status: ' . $order->post->comment_status . '<br>';    echo '$order->post->ping_status: ' . $order->post->ping_status . '<br>';    echo '$order->post->post_password: ' . $order->post->post_password . '<br>';    echo '$order->post->post_name: ' . $order->post->post_name . '<br>';    echo '$order->post->to_ping: ' . $order->post->to_ping . '<br>';    echo '$order->post->pinged: ' . $order->post->pinged . '<br>';    echo '$order->post->post_modified: ' . $order->post->post_modified . '<br>';    echo '$order->post->post_modified_gtm: ' . $order->post->post_modified_gtm . '<br>';    echo '$order->post->post_content_filtered: ' . $order->post->post_content_filtered . '<br>';    echo '$order->post->post_parent: ' . $order->post->post_parent . '<br>';    echo '$order->post->guid: ' . $order->post->guid . '<br>';    echo '$order->post->menu_order: ' . $order->post->menu_order . '<br>';    echo '$order->post->post_type: ' . $order->post->post_type . '<br>';    echo '$order->post->post_mime_type: ' . $order->post->post_mime_type . '<br>';    echo '$order->post->comment_count: ' . $order->post->comment_count . '<br>';    echo '$order->post->filter: ' . $order->post->filter . '<br>';    echo '<h4>THE ORDER OBJECT (again):</h4>';    echo '$order->order_date: ' . $order->order_date . '<br>';    echo '$order->modified_date: ' . $order->modified_date . '<br>';    echo '$order->customer_message: ' . $order->customer_message . '<br>';    echo '$order->customer_note: ' . $order->customer_note . '<br>';    echo '$order->post_status: ' . $order->post_status . '<br>';    echo '$order->prices_include_tax: ' . $order->prices_include_tax . '<br>';    echo '$order->tax_display_cart: ' . $order->tax_display_cart . '<br>';    echo '$order->display_totals_ex_tax: ' . $order->display_totals_ex_tax . '<br>';    echo '$order->display_cart_ex_tax: ' . $order->display_cart_ex_tax . '<br>';    echo '$order->formatted_billing_address->protected: ' . $order->formatted_billing_address->protected . '<br>';    echo '$order->formatted_shipping_address->protected: ' . $order->formatted_shipping_address->protected . '<br><br>';    echo '- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <br><br>';    // 2) Get the Order meta data    $order_meta = get_post_meta($order_id);    echo '<h3>RAW OUTPUT OF THE ORDER META DATA (ARRAY): </h3>';    print_r($order_meta);    echo '<br><br>';    echo '<h3>THE ORDER META DATA (Using the array syntax notation):</h3>';    echo '$order_meta[_order_key][0]: ' . $order_meta['_order_key'][0] . '<br>';    echo '$order_meta[_order_currency][0]: ' . $order_meta['_order_currency'][0] . '<br>';    echo '$order_meta[_prices_include_tax][0]: ' . $order_meta['_prices_include_tax'][0] . '<br>';    echo '$order_meta[_customer_user][0]: ' . $order_meta['_customer_user'][0] . '<br>';    echo '$order_meta[_billing_first_name][0]: ' . $order_meta['_billing_first_name'][0] . '<br><br>';    echo 'And so on ……… <br><br>';    echo '- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <br><br>';    // 3) Get the order items    $items = $order->get_items();    echo '<h3>RAW OUTPUT OF THE ORDER ITEMS DATA (ARRAY): </h3>';    foreach ( $items as $item_id => $item_data ) {        echo '<h4>RAW OUTPUT OF THE ORDER ITEM NUMBER: '. $item_id .'): </h4>';        print_r($item_data);        echo '<br><br>';        echo 'Item ID: ' . $item_id. '<br>';        echo '$item_data["product_id"] <i>(product ID)</i>: ' . $item_data['product_id'] . '<br>';        echo '$item_data["name"] <i>(product Name)</i>: ' . $item_data['name'] . '<br>';        // Using get_item_meta() method        echo 'Item quantity <i>(product quantity)</i>: ' . $order->get_item_meta($item_id, '_qty', true) . '<br><br>';        echo 'Item line total <i>(product quantity)</i>: ' . $order->get_item_meta($item_id, '_line_total', true) . '<br><br>';        echo 'And so on ……… <br><br>';        echo '- - - - - - - - - - - - - <br><br>';    }    echo '- - - - - - E N D - - - - - <br><br>';}